<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Seat Allocation System</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3f37c9;
            --secondary: #3a0ca3;
            --accent: #7209b7;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--light-gray);
        }

        h1, h2, h3, h4 {
            color: var(--dark);
            margin-bottom: 15px;
        }

        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn.outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn.outline:hover {
            background-color: var(--primary);
            color: white;
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 100%;
            max-width: 800px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-height: 90vh;
            overflow-y: auto;
        }
/* Enhanced Login Page with Animated Background */
.login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
    background: linear-gradient(-45deg, #4361ee, #4895ef, #3a0ca3, #7209b7);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    position: relative;
    overflow: hidden;
}

.login-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(5px);
    z-index: 0;
}

@keyframes gradientBG {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}

.login-card {
    background-color: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 40px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    position: relative;
    z-index: 1;
    transform: translateY(20px);
    opacity: 0;
    animation: fadeInUp 0.8s 0.3s ease-out forwards;
}

@keyframes fadeInUp {
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.login-logo {
    width: 80px;
    height: 80px;
    background-color: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32px;
    margin: 0 auto 15px;
    box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
    transform: scale(0);
    animation: popIn 0.6s 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes popIn {
    0% {
        transform: scale(0);
    }
    80% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
    }
}

.login-title {
    color: var(--primary);
    margin-bottom: 5px;
    font-size: 28px;
    font-weight: 600;
    text-align: center;
    opacity: 0;
    animation: fadeIn 0.8s 0.8s ease-out forwards;
}

.login-subtitle {
    color: var(--gray);
    margin-bottom: 30px;
    text-align: center;
    opacity: 0;
    animation: fadeIn 0.8s 0.9s ease-out forwards;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.login-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
    opacity: 0;
    animation: fadeIn 0.8s 1s ease-out forwards;
}

.input-group {
    position: relative;
    transition: all 0.3s ease;
}

.input-group:hover {
    transform: translateY(-2px);
}

.input-group i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
    transition: all 0.3s ease;
}

.input-group input {
    width: 100%;
    padding: 12px 15px 12px 40px;
    border: 1px solid var(--light-gray);
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s ease;
    background-color: rgba(255, 255, 255, 0.8);
}

.input-group input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    background-color: white;
}

.input-group input:focus + i {
    color: var(--primary);
    transform: translateY(-50%) scale(1.1);
}

.login-btn {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 14px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 6px rgba(67, 97, 238, 0.2);
    margin-top: 10px;
}

.login-btn:hover {
    background-color: var(--primary-dark);
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(67, 97, 238, 0.3);
}

.login-btn:active {
    transform: translateY(1px);
}

.login-footer {
    text-align: center;
    margin-top: 25px;
    color: var(--gray);
    font-size: 0.9em;
    opacity: 0;
    animation: fadeIn 0.8s 1.1s ease-out forwards;
}

.login-footer a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s ease;
    position: relative;
}

.login-footer a::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background-color: var(--primary);
    transition: width 0.3s ease;
}

.login-footer a:hover::after {
    width: 100%;
}

/* Floating bubbles animation */
.bubble {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    z-index: 0;
    animation: float 15s infinite linear;
}

@keyframes float {
    0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
    }
    100% {
        transform: translateY(-1000px) rotate(720deg);
        opacity: 0;
    }
}

/* Add bubbles dynamically with JavaScript or manually */
.bubble:nth-child(1) {
    width: 80px;
    height: 80px;
    left: 10%;
    top: 80%;
    animation-duration: 20s;
}

.bubble:nth-child(2) {
    width: 120px;
    height: 120px;
    left: 25%;
    top: 70%;
    animation-duration: 25s;
    animation-delay: 2s;
}

.bubble:nth-child(3) {
    width: 60px;
    height: 60px;
    left: 70%;
    top: 85%;
    animation-duration: 18s;
    animation-delay: 1s;
}

.bubble:nth-child(4) {
    width: 90px;
    height: 90px;
    left: 80%;
    top: 75%;
    animation-duration: 22s;
    animation-delay: 3s;
}

.bubble:nth-child(5) {
    width: 50px;
    height: 50px;
    left: 50%;
    top: 90%;
    animation-duration: 17s;
    animation-delay: 0.5s;
}
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        .close-modal:hover {
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--light-gray);
            border-radius: 5px;
            font-size: 16px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        /* Dashboard Layout */
        .dashboard, .admin-dashboard {
            display: flex;
            margin-top: 30px;
            gap: 20px;
        }

        .sidebar, .admin-sidebar {
            width: 250px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .content-area, .admin-content {
            flex: 1;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .profile, .admin-profile {
            text-align: center;
            margin-bottom: 30px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        nav ul {
            list-style: none;
        }
/* Drag and Drop Styles */
.student-card {
    padding: 10px;
    margin: 5px 0;
    background-color: var(--light-gray);
    border-radius: 5px;
    cursor: move;
    transition: all 0.2s ease;
}

.student-card:hover {
    background-color: var(--primary-light);
    color: white;
}

.seat-assignment-wrapper {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 20px;
    margin: 20px 0;
}

.students-panel, .classroom-panel {
    background-color: white;
    padding: 15px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

/* Modal Improvements */
.modal-content {
    max-width: 90%;
    width: 800px;
}

/* Button Improvements */
.btn i {
    pointer-events: none;
}

/* Print Button Specific */
.print-btn {
    background-color: var(--success);
}

.print-btn:hover {
    background-color: #3aa8d1;
}
        nav ul li {
            margin-bottom: 10px;
        }

        nav ul li a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: 5px;
            color: var(--gray);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        nav ul li a:hover, nav ul li.active a {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        nav ul li a i {
            width: 20px;
            text-align: center;
        }

        /* Seat Map */
        .seat-map-container {
            margin: 20px 0;
        }

        .seat-map {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .seat {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .seat.available {
            background-color: var(--light-gray);
            color: var(--dark);
        }

        .seat.occupied {
            background-color: var(--gray);
            color: white;
        }

        .seat.my-seat {
            background-color: var(--primary);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.5);
        }

        .seat-legend {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }

        /* Admin Styles */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        table th {
            background-color: var(--light-gray);
            font-weight: 600;
        }

        table tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin: 0 5px;
            color: var(--gray);
            transition: color 0.2s ease;
        }

        .action-btn.edit:hover {
            color: var(--primary);
        }

        .action-btn.delete:hover {
            color: var(--danger);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--dark);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success {
            background-color: var(--success);
        }

        .toast.error {
            background-color: var(--danger);
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--light-gray);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard, .admin-dashboard {
                flex-direction: column;
            }
            
            .sidebar, .admin-sidebar {
                width: 100%;
                margin-bottom: 20px;
            }
        }

        /* Exam Seating Specific Styles */
        .exam-seating-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .exam-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .exam-seat-map {
            display: grid;
            gap: 10px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .exam-seat {
            width: 60px;
            height: 60px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--light-gray);
        }
        /* Login Page Styles */
.login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: var(--primary);
    padding: 20px;
}

.login-card {
    background-color: white;
    border-radius: 10px;
    padding: 40px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.login-header {
    text-align: center;
    margin-bottom: 30px;
}

.login-logo {
    width: 60px;
    height: 60px;
    background-color: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    margin: 0 auto 15px;
}

.login-title {
    color: var(--primary);
    margin-bottom: 5px;
}

.login-subtitle {
    color: var(--gray);
    margin-bottom: 20px;
}

.login-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.input-group {
    position: relative;
}

.input-group i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
}

.input-group input {
    width: 100%;
    padding: 12px 15px 12px 40px;
    border: 1px solid var(--light-gray);
    border-radius: 5px;
    font-size: 16px;
}

.input-group input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
}

.login-btn {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 5px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
}

.login-btn:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
}

.login-footer {
    text-align: center;
    margin-top: 20px;
    color: var(--gray);
}

.login-footer a {
    color: var(--primary);
    text-decoration: none;
}
/* Login Page Styles */
.login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: #f5f7ff;
    padding: 20px;
}

.login-card {
    background-color: white;
    border-radius: 10px;
    padding: 40px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    margin: 50px auto;
}

.login-header {
    text-align: center;
    margin-bottom: 30px;
}

.login-logo {
    width: 80px;
    height: 80px;
    background-color: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32px;
    margin: 0 auto 15px;
}

.login-title {
    color: var(--primary);
    margin-bottom: 5px;
}

.login-subtitle {
    color: var(--gray);
    margin-bottom: 20px;
}

.login-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.input-group {
    position: relative;
}

.input-group i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
}

.input-group input {
    width: 100%;
    padding: 12px 15px 12px 40px;
    border: 1px solid var(--light-gray);
    border-radius: 5px;
    font-size: 16px;
}

.input-group input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
}

.login-btn {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 5px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
}

.login-btn:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
}

.login-footer {
    text-align: center;
    margin-top: 20px;
    color: var(--gray);
    font-size: 0.9em;
}

.login-footer a {
    color: var(--primary);
    text-decoration: none;
}

.login-footer a:hover {
    text-decoration: underline;
}
/* Print Styles */
@media print {
    body * {
        visibility: hidden;
    }
    .print-content, .print-content * {
        visibility: visible;
    }
    .print-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        padding: 20px;
        background: white;
    }
    .no-print {
        display: none !important;
    }
    
    /* Additional print-specific styles */
    .seat-map {
        display: grid;
        gap: 10px;
        margin: 20px 0;
    }
    
    .seat {
        width: 40px;
        height: 40px;
        border-radius: 5px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 12px;
        font-weight: bold;
        border: 1px solid #ccc;
    }
    
    .seat.available {
        background-color: #f8f9fa;
        color: #212529;
    }
    
    .seat.occupied {
        background-color: #4361ee;
        color: white;
    }
    
    .seat.my-seat {
        background-color: #f72585;
        color: white;
        border: 2px solid #000;
    }
    
    .seat.wall {
        background-color: #212529;
        color: white;
    }
    
    .seat.empty {
        background-color: transparent;
        border: 1px dashed #6c757d;
    }
}
        .exam-seat.occupied {
            background-color: var(--primary);
            color: white;
        }

        /* Card Styles */
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        /* Badge Styles */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background-color: var(--light-gray);
            color: var(--dark);
        }

        .badge-primary {
            background-color: var(--primary);
            color: white;
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            background-color: var(--light-gray);
            border-radius: 5px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .mode-toggle-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .mode-toggle-btn.active {
            background-color: var(--primary);
            color: white;
        }

        /* Layout Editor */
        .layout-editor {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .layout-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .layout-grid {
            display: grid;
            gap: 10px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .layout-cell {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--light-gray);
        }

        .layout-cell.seat {
            background-color: var(--primary);
            color: white;
        }

        .layout-cell.wall {
            background-color: var(--dark);
            color: white;
        }

        .layout-cell.empty {
            background-color: transparent;
            border: 1px dashed var(--gray);
        }

        /* Allocation Management */
        .allocation-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-content, .print-content * {
                visibility: visible;
            }
            .print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }

        /* Student View Seat Map */
        .student-seat-map-container {
            margin: 20px 0;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .student-seat-map {
            display: grid;
            gap: 10px;
            margin: 20px 0;
        }

        .student-seat {
            width: 60px;
            height: 60px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
            background-color: var(--light-gray);
        }

        .student-seat.occupied {
            background-color: var(--gray);
            color: white;
        }

        .student-seat.my-seat {
            background-color: var(--primary);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.5);
        }

        .student-seat-info {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--light-gray);
            border-radius: 5px;
        }

        .student-allocation-details {
            margin-top: 20px;
        }

        .student-allocation-details p {
            margin-bottom: 10px;
        }
    </style>
</head>
<body><div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div id="app-container">
        <!-- Login Page (Default View) -->
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="login-container" id="loginPage" style="display: none;">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">
                        <i class="fas fa-chair"></i><div class="bubble"></div>
                        
                    </div>
                    <h1 class="login-title">Exam Seat Allocation</h1>
                    <p class="login-subtitle">Manage exam seating arrangements</p>
                </div>
                
                <form class="login-form" id="loginForm">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="username" placeholder="Username or Roll Number" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" placeholder="Password" required>
                    </div>
                    
                    <button type="submit" class="login-btn">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                
                <div class="login-footer">
                    <p>Need help? <a href="#" style="color: white;">Contact support</a></p>
                </div>
            </div>
        </div>

        <!-- Student Portal (Hidden by Default) -->
        <div class="container" id="studentPortal" style="display:none;">
            <header>
                <div class="logo">
                    <i class="fas fa-chair"></i>
                    <h1>Exam Seat Allocation - Student Portal</h1>
                </div>
                <div class="auth-buttons">
                    <button id="studentLogoutBtn" class="btn outline">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </header>
            
            <div class="dashboard">
                <div class="sidebar">
                    <div class="profile">
                        <div class="avatar" id="studentAvatar">S</div>
                        <h3 id="studentName">Student Name</h3>
                        <p id="studentRollNo">Roll No: </p>
                    </div>
                    <nav>
                        <ul>
                            <li class="active"><a href="#" data-section="my-allocations"><i class="fas fa-clipboard-check"></i> My Allocations</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="content-area">
                    <div class="content-section" id="my-allocations">
                        <h2>My Allocations</h2>
                        
                        <div class="card">
                            <h3>Exam Allocations</h3>
                            <div id="examAllocationsList">
                                <!-- Exam allocations will be populated here -->
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3>Classroom Allocations</h3>
                            <div id="classroomAllocationsList">
                                <!-- Classroom allocations will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Portal (Hidden by Default) -->
        <div class="container" id="adminPortal" style="display:none;">
            <header>
                <div class="logo">
                    <i class="fas fa-chair"></i>
                    <h1>Exam Seat Allocation - Admin Portal</h1>
                </div>
                <div class="auth-buttons">
                    <button id="adminLogoutBtn" class="btn outline">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </header>

            <div class="admin-dashboard">
                <div class="admin-sidebar">
                    <div class="admin-profile">
                        <div class="avatar">A</div>
                        <h3>Admin Panel</h3>
                    </div>
                    <nav>
                        <ul>
                            <li class="active"><a href="#" data-section="seat-allocation"><i class="fas fa-chair"></i> Seat Allocation</a></li>
                            <li><a href="#" data-section="allocation-management"><i class="fas fa-list"></i> Allocation Management</a></li>
                            <li><a href="#" data-section="manage-students"><i class="fas fa-users"></i> Manage Students</a></li>
                            <li><a href="#" data-section="manage-classrooms"><i class="fas fa-building"></i> Manage Classrooms</a></li>
                            <li><a href="#" data-section="manage-exams"><i class="fas fa-book"></i> Manage Exams</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="admin-content">
                    <!-- Seat Allocation Section -->
                    <div class="content-section" id="seat-allocation">
                        <div class="section-header">
                            <h2>Seat Allocation</h2>
                        </div>
                        
                        <div class="mode-toggle">
                            <div class="mode-toggle-btn active" data-mode="exam">Exam Seating</div>
                            <div class="mode-toggle-btn" data-mode="classroom">Classroom Allocation</div>
                        </div>
                        
                        <!-- Exam Seating Mode -->
                        <div class="exam-seating-container" id="exam-seating-mode">
                            <div class="exam-controls">
                                <select id="examClassroom" class="form-group">
                                    <option value="">Select a classroom</option>
                                </select>
                                <select id="examSubject" class="form-group">
                                    <option value="">Select an exam</option>
                                </select>
                                <input type="date" id="examDate" class="form-group">
                                <input type="time" id="examTime" class="form-group">
                                <button id="generateExamSeatingBtn" class="btn">
                                    <i class="fas fa-magic"></i> Generate Seating
                                </button>
                            </div>
                            
                            <div id="examSeatMapContainer" style="display: none;">
                                <h3>Exam Seating Arrangement</h3>
                                <div class="exam-seat-map" id="examSeatMap">
                                    <!-- Exam seat map will be generated here -->
                                </div>
                                
                                <div class="form-actions" style="margin-top: 20px;">
                                    <button id="saveExamAssignmentsBtn" class="btn">
                                        <i class="fas fa-save"></i> Save Exam Seating
                                    </button>
                                    <button id="printExamSeatingBtn" class="btn outline">
                                        <i class="fas fa-print"></i> Print Seating Chart
                                    </button>
                                    <button id="clearExamAssignmentsBtn" class="btn outline">
                                        <i class="fas fa-broom"></i> Clear All
                                    </button>
                                    <button id="autoAssignBtn" class="btn outline">
                                        <i class="fas fa-random"></i> Auto Assign
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Classroom Allocation Mode -->
                        <div class="layout-editor" id="classroom-allocation-mode" style="display: none;">
                            <div class="layout-controls">
                                <select id="classroomSelector" class="form-group">
                                    <option value="">Select a classroom</option>
                                </select>
                                <button id="createLayoutBtn" class="btn">
                                    <i class="fas fa-plus"></i> Create New Layout
                                </button>
                                <button id="saveLayoutBtn" class="btn" style="display: none;">
                                    <i class="fas fa-save"></i> Save Layout
                                </button>
                            </div>
                            
                            <div class="layout-tools">
                                <h4>Layout Tools</h4>
                                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                    <button class="btn outline layout-tool-btn active" data-tool="seat">
                                        <i class="fas fa-chair"></i> Add Seat
                                    </button>
                                    <button class="btn outline layout-tool-btn" data-tool="wall">
                                        <i class="fas fa-wall"></i> Add Wall
                                    </button>
                                    <button class="btn outline layout-tool-btn" data-tool="empty">
                                        <i class="fas fa-square"></i> Empty Space
                                    </button>
                                    <button class="btn outline layout-tool-btn" data-tool="delete">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </div>
                            
                            <div id="layoutEditorContainer" style="display: none;">
                                <div class="layout-grid" id="layoutGrid">
                                    <!-- Layout grid will be generated here -->
                                </div>
                                
                                <div class="form-actions">
                                    <button id="assignStudentsBtn" class="btn">
                                        <i class="fas fa-users"></i> Assign Students
                                    </button>
                                    <button id="printClassroomLayoutBtn" class="btn outline">
                                        <i class="fas fa-print"></i> Print Layout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Allocation Management Section -->
                    <div class="content-section" id="allocation-management" style="display:none;">
                        <div class="section-header">
                            <h2>Allocation Management</h2>
                            <div>
                                <button id="exportAllocationsBtn" class="btn outline">
                                    <i class="fas fa-file-export"></i> Export Allocations
                                </button>
                                <button id="importAllocationsBtn" class="btn outline">
                                    <i class="fas fa-file-import"></i> Import Allocations
                                </button>
                            </div>
                        </div>
                        
                        <div class="allocation-filters">
                            <select id="filterType" class="form-group">
                                <option value="">All Types</option>
                                <option value="exam">Exam</option>
                                <option value="classroom">Classroom</option>
                            </select>
                            <select id="filterClassroom" class="form-group">
                                <option value="">All Classrooms</option>
                            </select>
                            <input type="date" id="filterDate" class="form-group" placeholder="Filter by date">
                            <button id="applyFiltersBtn" class="btn">
                                <i class="fas fa-filter"></i> Apply Filters
                            </button>
                            <button id="clearFiltersBtn" class="btn outline">
                                <i class="fas fa-broom"></i> Clear
                            </button>
                        </div>
                        
                        <div class="allocations-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Classroom</th>
                                        <th>Exam/Description</th>
                                        <th>Date</th>
                                        <th>Time</th>
                                        <th>Students</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="allocationsTableBody">
                                    <!-- Allocations will be populated via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Students Management -->
                    <div class="content-section" id="manage-students" style="display:none;">
                        <div class="section-header">
                            <h2>Manage Students</h2>
                            <div class="action-buttons">
                                <button id="addStudentBtn" class="btn"><i class="fas fa-plus"></i> Add Student</button>
                                <button id="importStudentsBtn" class="btn outline"><i class="fas fa-file-import"></i> Import Students</button>
                            </div>
                        </div>
                        
                        <div class="students-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Roll No</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Department</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="studentsTableBody">
                                    <!-- Students will be populated via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Classrooms Management -->
                    <div class="content-section" id="manage-classrooms" style="display:none;">
                        <div class="section-header">
                            <h2>Manage Classrooms</h2>
                            <button id="addClassroomBtn" class="btn"><i class="fas fa-plus"></i> Add Classroom</button>
                        </div>
                        <div class="classrooms-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Block</th>
                                        <th>Capacity</th>
                                        <th>Layouts</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="classroomsTableBody">
                                    <!-- Classrooms will be populated via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Exams Management -->
                    <div class="content-section" id="manage-exams" style="display:none;">
                        <div class="section-header">
                            <h2>Manage Exams</h2>
                            <button id="addExamBtn" class="btn"><i class="fas fa-plus"></i> Add Exam</button>
                        </div>
                        <div class="exams-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Code</th>
                                        <th>Date</th>
                                        <th>Time</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="examsTableBody">
                                    <!-- Exams will be populated via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Student Modal -->
            <div class="modal" id="studentModal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2 id="studentModalTitle">Add New Student</h2>
                    <form id="studentForm">
                        <input type="hidden" id="studentId">
                        <div class="form-group">
                            <label for="studentRollNo">Roll No</label>
                            <input type="text" id="studentRollNo" required>
                        </div>
                        <div class="form-group">
                            <label for="studentName">Full Name</label>
                            <input type="text" id="studentName" required>
                        </div>
                        <div class="form-group">
                            <label for="studentEmail">Email</label>
                            <input type="email" id="studentEmail">
                        </div>
                        <div class="form-group">
                            <label for="studentDepartment">Department</label>
                            <input type="text" id="studentDepartment">
                        </div>
                        <div class="form-group">
                            <label for="studentPassword">Password</label>
                            <input type="password" id="studentPassword" required>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn outline" id="cancelStudentBtn">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Classroom Modal -->
            <div class="modal" id="classroomModal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2 id="classroomModalTitle">Add New Classroom</h2>
                    <form id="classroomForm">
                        <input type="hidden" id="classroomId">
                        <div class="form-group">
                            <label for="classroomName">Classroom Name</label>
                            <input type="text" id="classroomName" required>
                        </div>
                        <div class="form-group">
                            <label for="classroomBlock">Block</label>
                            <input type="text" id="classroomBlock" required>
                        </div>
                        <div class="form-group">
                            <label for="classroomCapacity">Capacity</label>
                            <input type="number" id="classroomCapacity" required>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn outline" id="cancelClassroomBtn">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Exam Modal -->
            <div class="modal" id="examModal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2 id="examModalTitle">Add New Exam</h2>
                    <form id="examForm">
                        <input type="hidden" id="examId">
                        <div class="form-group">
                            <label for="examName">Exam Name</label>
                            <input type="text" id="examName" required>
                        </div>
                        <div class="form-group">
                            <label for="examCode">Exam Code</label>
                            <input type="text" id="examCode" required>
                        </div>
                        <div class="form-group">
                            <label for="examDate">Date</label>
                            <input type="date" id="examDate" required>
                        </div>
                        <div class="form-group">
                            <label for="examTime">Time</label>
                            <input type="time" id="examTime" required>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn outline" id="cancelExamBtn">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Import Modal -->
            <div class="modal" id="importModal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2>Import Data</h2>
                    <div class="form-group">
                        <label for="importType">Import Type</label>
                        <select id="importType" class="form-group">
                            <option value="students">Students</option>
                            <option value="allocations">Allocations</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="importFile">Select File (JSON)</label>
                        <input type="file" id="importFile" accept=".json">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn outline" id="cancelImportBtn">Cancel</button>
                        <button type="button" class="btn" id="confirmImportBtn">Import</button>
                    </div>
                </div>
            </div>

            <!-- Assign Students Modal -->
            <div class="modal" id="assignStudentsModal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2>Assign Students to Classroom</h2>
                    <div class="seat-assignment-wrapper">
                        <div class="students-panel">
                            <h4>Available Students</h4>
                            <div id="availableStudentsList">
                                <!-- Students will be populated here -->
                            </div>
                        </div>
                        <div class="classroom-panel">
                            <h4>Classroom Layout</h4>
                            <div class="seat-map" id="classroomSeatMap">
                                <!-- Classroom seat map will be generated here -->
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn outline" id="cancelAssignStudentsBtn">Cancel</button>
                        <button type="button" class="btn" id="saveAssignmentsBtn">Save Assignments</button>
                    </div>
                </div>
            </div>

            <!-- Toast Notification -->
            <div class="toast" id="toastNotification">
                <i class="fas fa-check-circle"></i>
                <span id="toastMessage">Operation successful</span>
            </div>

            <!-- Print Content (Hidden) -->
            <div id="printContent" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Database (in-memory for this single-file solution)
        let db = {
            students: [
                { id: "1", rollNo: "1", name: "Student 1", email: "student1@example.com", department: "Computer Science", password: "student123" },
                { id: "2", rollNo: "2", name: "Student 2", email: "student2@example.com", department: "Electrical Engineering", password: "student123" },
                { id: "3", rollNo: "3", name: "Student 3", email: "student3@example.com", department: "Mechanical Engineering", password: "student123" },
                { id: "4", rollNo: "4", name: "Student 4", email: "student4@example.com", department: "Civil Engineering", password: "student123" },
                { id: "5", rollNo: "5", name: "Student 5", email: "student5@example.com", department: "Computer Science", password: "student123" },
                { id: "6", rollNo: "6", name: "Student 6", email: "student6@example.com", department: "Electrical Engineering", password: "student123" },
                { id: "7", rollNo: "7", name: "Student 7", email: "student7@example.com", department: "Mechanical Engineering", password: "student123" },
                { id: "8", rollNo: "8", name: "Student 8", email: "student8@example.com", department: "Civil Engineering", password: "student123" },
                { id: "9", rollNo: "9", name: "Student 9", email: "student9@example.com", department: "Computer Science", password: "student123" },
                { id: "10", rollNo: "10", name: "Student 10", email: "student10@example.com", department: "Electrical Engineering", password: "student123" }
            ],
            admins: [
                { id: "a1", name: "Admin User", email: "admin@example.com", password: "admin123" }
            ],
            classrooms: [
                { id: "c1", name: "Room 101", block: "A", capacity: 30, layouts: [] },
                { id: "c2", name: "Room 102", block: "A", capacity: 30, layouts: [] },
                { id: "c3", name: "Room 201", block: "B", capacity: 30, layouts: [] },
                { id: "c4", name: "Room 202", block: "B", capacity: 30, layouts: [] },
                { id: "c5", name: "Room 301", block: "C", capacity: 30, layouts: [] }
            ],
            exams: [
                { id: "e1", name: "Mathematics Final", code: "MATH101", date: "2023-06-20", time: "09:00" },
                { id: "e2", name: "Physics Midterm", code: "PHY101", date: "2023-06-22", time: "10:00" },
                { id: "e3", name: "Chemistry Quiz", code: "CHEM101", date: "2023-06-24", time: "11:00" }
            ],
            allocations: [
                { 
                    id: "a1", 
                    type: "exam", 
                    classroomId: "c1", 
                    examId: "e1", 
                    date: "2023-06-20", 
                    time: "09:00",
                    layout: null,
                    assignments: [
                        { studentId: "1", seat: "1" },
                        { studentId: "2", seat: "2" },
                        { studentId: "3", seat: "3" }
                    ],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                },
                { 
                    id: "a2", 
                    type: "classroom", 
                    classroomId: "c2", 
                    examId: null, 
                    date: null, 
                    time: null,
                    layout: {
                        rows: 5,
                        cols: 6,
                        seats: [
                            { row: 0, col: 0, type: "seat" },
                            { row: 0, col: 1, type: "seat" },
                            { row: 0, col: 2, type: "empty" },
                            // More seat definitions...
                        ]
                    },
                    assignments: [
                        { studentId: "4", seat: "1" },
                        { studentId: "5", seat: "2" }
                    ],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ]
        };

        // Current User
        let currentUser = null;
        let currentMode = "exam";
        let currentLayoutTool = "seat";
        let currentClassroomId = null;
        let currentExamId = null;
        let currentLayout = null;
        let draggedStudent = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we're coming back from a refresh
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (currentUser.role === 'admin') {
                    showAdminPortal();
                } else {
                    showStudentPortal();
                }
            } else {
                showLoginPage();
            }

            // Setup event listeners
            setupEventListeners();
        });

        // Show login page
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('studentPortal').style.display = 'none';
            document.getElementById('adminPortal').style.display = 'none';
        }

        // Show student portal
        function showStudentPortal() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('studentPortal').style.display = 'block';
            document.getElementById('adminPortal').style.display = 'none';
            
            // Update student info
            const student = db.students.find(s => s.id === currentUser.id);
            if (student) {
                document.getElementById('studentName').textContent = student.name;
                document.getElementById('studentRollNo').textContent = `Roll No: ${student.rollNo}`;
                document.getElementById('studentAvatar').textContent = student.name.charAt(0).toUpperCase();
            }
            
            // Load initial data
            loadStudentData();
        }

        // Show admin portal
        function showAdminPortal() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('studentPortal').style.display = 'none';
            document.getElementById('adminPortal').style.display = 'block';
            
            // Load initial data
            loadAdminData();
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });

            // Student portal
            document.getElementById('studentLogoutBtn').addEventListener('click', logout);
            
            // Navigation links
            document.querySelectorAll('[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });

            // Admin portal
            document.getElementById('adminLogoutBtn').addEventListener('click', logout);
            
            // Navigation links for admin
            document.querySelectorAll('.admin-sidebar nav [data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showAdminSection(section);
                });
            });

            // Mode toggle
            document.querySelectorAll('.mode-toggle-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.mode-toggle-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentMode = this.dataset.mode;
                    
                    document.getElementById('exam-seating-mode').style.display = 'none';
                    document.getElementById('classroom-allocation-mode').style.display = 'none';
                    
                    if (currentMode === 'exam') {
                        document.getElementById('exam-seating-mode').style.display = 'block';
                    } else {
                        document.getElementById('classroom-allocation-mode').style.display = 'block';
                    }
                });
            });

            // Layout tools
            document.querySelectorAll('.layout-tool-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.layout-tool-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentLayoutTool = this.dataset.tool;
                });
            });

            // Student management
            document.getElementById('addStudentBtn').addEventListener('click', showAddStudentForm);
            document.getElementById('studentForm').addEventListener('submit', saveStudent);
            document.getElementById('cancelStudentBtn').addEventListener('click', function() {
                document.getElementById('studentModal').style.display = 'none';
            });
            document.getElementById('importStudentsBtn').addEventListener('click', function() {
                document.getElementById('importType').value = 'students';
                document.getElementById('importModal').style.display = 'flex';
            });

            // Classroom management
            document.getElementById('addClassroomBtn').addEventListener('click', showAddClassroomForm);
            document.getElementById('classroomForm').addEventListener('submit', saveClassroom);
            document.getElementById('cancelClassroomBtn').addEventListener('click', function() {
                document.getElementById('classroomModal').style.display = 'none';
            });

            // Exam management
            document.getElementById('addExamBtn').addEventListener('click', showAddExamForm);
            document.getElementById('examForm').addEventListener('submit', saveExam);
            document.getElementById('cancelExamBtn').addEventListener('click', function() {
                document.getElementById('examModal').style.display = 'none';
            });

            // Import/Export
            document.getElementById('exportAllocationsBtn').addEventListener('click', exportAllocations);
            document.getElementById('importAllocationsBtn').addEventListener('click', function() {
                document.getElementById('importType').value = 'allocations';
                document.getElementById('importModal').style.display = 'flex';
            });
            document.getElementById('confirmImportBtn').addEventListener('click', handleImport);
            document.getElementById('cancelImportBtn').addEventListener('click', function() {
                document.getElementById('importModal').style.display = 'none';
            });

            // Modal close buttons
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });

            // Exam seating
            document.getElementById('generateExamSeatingBtn').addEventListener('click', generateExamSeating);
            document.getElementById('saveExamAssignmentsBtn').addEventListener('click', saveExamAssignments);
            document.getElementById('clearExamAssignmentsBtn').addEventListener('click', clearExamAssignments);
            document.getElementById('autoAssignBtn').addEventListener('click', autoAssignStudents);
            document.getElementById('printExamSeatingBtn').addEventListener('click', printExamSeating);
            
            // Classroom layout
            document.getElementById('classroomSelector').addEventListener('change', loadClassroomLayout);
            document.getElementById('createLayoutBtn').addEventListener('click', createNewLayout);
            document.getElementById('saveLayoutBtn').addEventListener('click', saveClassroomLayout);
            document.getElementById('assignStudentsBtn').addEventListener('click', showAssignStudentsModal);
            document.getElementById('printClassroomLayoutBtn').addEventListener('click', printClassroomLayout);
            
            // Assign students
            document.getElementById('saveAssignmentsBtn').addEventListener('click', saveClassroomAssignments);
            document.getElementById('cancelAssignStudentsBtn').addEventListener('click', function() {
                document.getElementById('assignStudentsModal').style.display = 'none';
            });
            
            // Allocation management
            document.getElementById('applyFiltersBtn').addEventListener('click', applyAllocationFilters);
            document.getElementById('clearFiltersBtn').addEventListener('click', clearAllocationFilters);
        }

        // Handle login
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Check admin credentials
            if (username === 'admin' && password === 'admin123') {
                const admin = db.admins.find(a => a.name.toLowerCase() === 'admin user');
                if (admin) {
                    currentUser = {
                        id: admin.id,
                        name: admin.name,
                        role: 'admin'
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showAdminPortal();
                    return;
                }
            }

            // Check student credentials
            const student = db.students.find(s => 
                (s.rollNo === username || s.name.toLowerCase() === username.toLowerCase()) && 
                s.password === password
            );

            if (student) {
                currentUser = {
                    id: student.id,
                    name: student.name,
                    rollNo: student.rollNo,
                    role: 'student'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showStudentPortal();
                return;
            }

            // Show demo credentials in alert (not on page)
            alert('Invalid credentials. Please try again.\n\nDemo credentials:\nAdmin: admin / admin123\nStudent: 10 / student123');
        }

        // Logout
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLoginPage();
        }

        // Show section in student portal
        function showSection(sectionId) {
            // Update active nav item
            document.querySelectorAll('nav li').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`nav li a[data-section="${sectionId}"]`).parentElement.classList.add('active');

            // Show the selected section
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';

            // Load data if needed
            if (sectionId === 'my-allocations') {
                loadStudentAllocations();
            }
        }

        // Load student data
        function loadStudentData() {
            // Load initial section
            showSection('my-allocations');
        }

        // Load student allocations
        function loadStudentAllocations() {
            if (!currentUser) return;
            
            const examContainer = document.getElementById('examAllocationsList');
            const classroomContainer = document.getElementById('classroomAllocationsList');
            
            examContainer.innerHTML = '';
            classroomContainer.innerHTML = '';
            
            // Find allocations for the student
            const examAllocations = db.allocations
    .filter(a => 
        a.type === 'exam' && 
        a.assignments.some(as => as.studentId === currentUser.id)
    )
    .map(a => {
        const exam = db.exams.find(e => e.id === a.examId);
        const classroom = db.classrooms.find(c => c.id === a.classroomId);
        const assignment = a.assignments.find(as => as.studentId === currentUser.id);
        
        return {
            id: a.id,
            examName: exam ? exam.name : 'Unknown',
            examCode: exam ? exam.code : '',
            date: a.date,
            time: a.time,
            classroom: classroom ? `${classroom.name} (Block ${classroom.block})` : 'Unknown',
            seat: assignment ? assignment.seat : 'Unknown'
        };
    });


            const classroomAllocations = db.allocations.filter(a => 
                a.type === 'classroom' && 
                a.assignments.some(as => as.studentId === currentUser.id))
                .map(a => {
                    const classroom = db.classrooms.find(c => c.id === a.classroomId);
                    const assignment = a.assignments.find(as => as.studentId === currentUser.id);
                    
                    return {
                        id: a.id,
                        classroom: classroom ? `${classroom.name} (Block ${classroom.block})` : 'Unknown',
                        seat: assignment ? assignment.seat : 'Unknown'
                    };
                });
            
            if (examAllocations.length === 0) {
                examContainer.innerHTML = '<p>No exam allocations found</p>';
            } else {
                examAllocations.forEach(allocation => {
                    const card = document.createElement('div');
                    card.className = 'exam-allocation-card';
                    card.innerHTML = `
                        <h4>${allocation.examName} (${allocation.examCode})</h4>
                        <p><strong>Date:</strong> ${new Date(allocation.date).toLocaleDateString()}</p>
                        <p><strong>Time:</strong> ${allocation.time}</p>
                        <p><strong>Room:</strong> ${allocation.classroom}</p>
                        <p><strong>Seat:</strong> ${allocation.seat}</p>
                        <button class="btn outline view-layout-btn" data-id="${allocation.id}">
                            <i class="fas fa-chair"></i> View Layout
                        </button>
                    `;
                    examContainer.appendChild(card);
                });
            }
            
            if (classroomAllocations.length === 0) {
                classroomContainer.innerHTML = '<p>No classroom allocations found</p>';
            } else {
                classroomAllocations.forEach(allocation => {
                    const card = document.createElement('div');
                    card.className = 'classroom-allocation-card';
                    card.innerHTML = `
                        <h4>${allocation.classroom}</h4>
                        <p><strong>Seat:</strong> ${allocation.seat}</p>
                        <button class="btn outline view-layout-btn" data-id="${allocation.id}">
                            <i class="fas fa-chair"></i> View Layout
                        </button>
                    `;
                    classroomContainer.appendChild(card);
                });
            }
            
            // Add event listeners to view layout buttons
            document.querySelectorAll('.view-layout-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const allocationId = this.dataset.id;
                    viewAllocationLayout(allocationId);
                });
            });
        }

        // View allocation layout
        function viewAllocationLayout(allocationId) {
            const allocation = db.allocations.find(a => a.id === allocationId);
            if (!allocation) return;
            
            const classroom = db.classrooms.find(c => c.id === allocation.classroomId);
            if (!classroom) return;
            
            const studentAssignment = allocation.assignments.find(a => a.studentId === currentUser.id);
            
            // Create a modal to show the layout
            const modalContent = document.createElement('div');
            modalContent.className = 'student-seat-map-container';
            
            if (allocation.type === 'exam') {
                const exam = db.exams.find(e => e.id === allocation.examId);
                
                modalContent.innerHTML = `
                    <h3>${exam ? exam.name : 'Exam'} Seating Chart</h3>
                    <p><strong>Date:</strong> ${allocation.date}</p>
                    <p><strong>Time:</strong> ${allocation.time}</p>
                    <p><strong>Room:</strong> ${classroom.name} (Block ${classroom.block})</p>
                    <div class="student-seat-map" id="studentSeatMap"></div>
                    <div class="student-seat-info">
                        <h4>Your Seat Information</h4>
                        <p><strong>Seat:</strong> ${studentAssignment?.seat || 'Not assigned'}</p>
                    </div>
                    <div class="form-actions">
                        <button class="btn print-btn" id="printStudentSeatBtn">
                            <i class="fas fa-print"></i> Print Seat Chart
                        </button>
                    </div>
                `;
                
                const seatMap = modalContent.querySelector('#studentSeatMap');
                
                if (allocation.layout) {
                    // Use the actual layout
                    renderStudentSeatMapWithLayout(seatMap, allocation.layout, studentAssignment?.seat);
                } else {
                    // Fallback to simple grid
                    const cols = Math.ceil(Math.sqrt(classroom.capacity));
                    seatMap.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
                    
                    for (let i = 1; i <= classroom.capacity; i++) {
                        const seat = document.createElement('div');
                        seat.className = 'student-seat';
                        seat.textContent = i;
                        
                        const assignment = allocation.assignments.find(a => a.seat === i.toString());
                        if (assignment) {
                            seat.classList.add('occupied');
                            if (studentAssignment && assignment.studentId === studentAssignment.studentId) {
                                seat.classList.add('my-seat');
                            }
                        }
                        
                        seatMap.appendChild(seat);
                    }
                }
            } else {
                // Classroom allocation
                modalContent.innerHTML = `
                    <h3>Classroom Seating Chart</h3>
                    <p><strong>Room:</strong> ${classroom.name} (Block ${classroom.block})</p>
                    <div class="student-seat-map" id="studentSeatMap"></div>
                    <div class="student-seat-info">
                        <h4>Your Seat Information</h4>
                        <p><strong>Seat:</strong> ${studentAssignment?.seat || 'Not assigned'}</p>
                    </div>
                    <div class="form-actions">
                        <button class="btn print-btn" id="printStudentSeatBtn">
                            <i class="fas fa-print"></i> Print Seat Chart
                        </button>
                    </div>
                `;
                
                const seatMap = modalContent.querySelector('#studentSeatMap');
                
                if (allocation.layout) {
                    renderStudentSeatMapWithLayout(seatMap, allocation.layout, studentAssignment?.seat);
                } else {
                    // Fallback to simple grid
                    const cols = Math.ceil(Math.sqrt(classroom.capacity));
                    seatMap.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
                    
                    for (let i = 1; i <= classroom.capacity; i++) {
                        const seat = document.createElement('div');
                        seat.className = 'student-seat';
                        seat.textContent = i;
                        
                        const assignment = allocation.assignments.find(a => a.seat === i.toString());
                        if (assignment) {
                            seat.classList.add('occupied');
                            if (studentAssignment && assignment.studentId === studentAssignment.studentId) {
                                seat.classList.add('my-seat');
                            }
                        }
                        
                        seatMap.appendChild(seat);
                    }
                }
            }
            
            // Create a modal to display the content
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            
            const modalInner = document.createElement('div');
            modalInner.className = 'modal-content';
            modalInner.innerHTML = '<span class="close-modal">&times;</span>';
            modalInner.appendChild(modalContent);
            
            modal.appendChild(modalInner);
            document.body.appendChild(modal);
            
            // Add close button event
            modal.querySelector('.close-modal').addEventListener('click', function() {
                modal.style.display = 'none';
                setTimeout(() => modal.remove(), 300);
            });
            
            // Add print button event
            modal.querySelector('#printStudentSeatBtn')?.addEventListener('click', function() {
                printSeatChart(modalContent.innerHTML, `${classroom.name} Seating Chart`);
            });
        }

        // Render student seat map with layout
        function renderStudentSeatMapWithLayout(container, layout, studentSeat) {
            const rows = layout.rows;
            const cols = layout.cols;
            
            container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            container.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
            
            layout.seats.forEach((seat, index) => {
                const seatElement = document.createElement('div');
                seatElement.className = 'student-seat';
                
                if (seat.type === 'seat') {
                    const seatNumber = index + 1;
                    seatElement.textContent = seatNumber;
                    
                    // Check if this seat is assigned to the current student
                    if (studentSeat && seatNumber.toString() === studentSeat) {
                        seatElement.classList.add('my-seat');
                    } else {
                        seatElement.classList.add('occupied');
                    }
                } else if (seat.type === 'wall') {
                    seatElement.className = 'student-seat wall';
                } else if (seat.type === 'empty') {
                    seatElement.className = 'student-seat empty';
                }
                
                container.appendChild(seatElement);
            });
        }

        // Print seat chart
        function printSeatChart(content, title) {
            const printContent = document.getElementById('printContent');
            printContent.innerHTML = `
                <div class="print-content">
                    <h2 style="text-align: center; margin-bottom: 20px;">${title}</h2>
                    ${content}
                </div>
            `;
            
            // Trigger print
            window.print();
        }

        // Show section in admin portal
        function showAdminSection(sectionId) {
            // Update active nav item
            document.querySelectorAll('.admin-sidebar nav li').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.admin-sidebar nav li a[data-section="${sectionId}"]`).parentElement.classList.add('active');

            // Show the selected section
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';

            // Load data if needed
            switch (sectionId) {
                case 'seat-allocation':
                    loadSeatAllocationData();
                    break;
                case 'allocation-management':
                    loadAllocationManagementData();
                    break;
                case 'manage-students':
                    loadStudentsTable();
                    break;
                case 'manage-classrooms':
                    loadClassroomsTable();
                    break;
                case 'manage-exams':
                    loadExamsTable();
                    break;
            }
        }

        // Load admin data
        function loadAdminData() {
            // Load initial section
            showAdminSection('seat-allocation');
        }

        // Load seat allocation data
        function loadSeatAllocationData() {
            // Populate classroom dropdown
            const classroomSelect = document.getElementById('examClassroom');
            classroomSelect.innerHTML = '<option value="">Select a classroom</option>';
            db.classrooms.forEach(classroom => {
                const option = document.createElement('option');
                option.value = classroom.id;
                option.textContent = `${classroom.name} (Block ${classroom.block}) - Capacity: ${classroom.capacity}`;
                classroomSelect.appendChild(option);
            });
            
            // Populate exam dropdown
            const examSelect = document.getElementById('examSubject');
            examSelect.innerHTML = '<option value="">Select an exam</option>';
            db.exams.forEach(exam => {
                const option = document.createElement('option');
                option.value = exam.id;
                option.textContent = `${exam.name} (${exam.code}) - ${exam.date} ${exam.time}`;
                examSelect.appendChild(option);
            });
            
            // Populate classroom selector for layout editor
            const classroomSelector = document.getElementById('classroomSelector');
            classroomSelector.innerHTML = '<option value="">Select a classroom</option>';
            db.classrooms.forEach(classroom => {
                const option = document.createElement('option');
                option.value = classroom.id;
                option.textContent = `${classroom.name} (Block ${classroom.block})`;
                classroomSelector.appendChild(option);
            });
        }

        // Generate exam seating
        function generateExamSeating() {
            const classroomId = document.getElementById('examClassroom').value;
            const examId = document.getElementById('examSubject').value;
            const date = document.getElementById('examDate').value;
            const time = document.getElementById('examTime').value;
            
            if (!classroomId || !examId || !date || !time) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            currentClassroomId = classroomId;
            currentExamId = examId;
            
            const classroom = db.classrooms.find(c => c.id === classroomId);
            const exam = db.exams.find(e => e.id === examId);
            
            if (!classroom || !exam) {
                showToast('Invalid classroom or exam selected', 'error');
                return;
            }
            
            // Check if we already have an allocation for this exam and classroom
            let allocation = db.allocations.find(a => 
                a.type === 'exam' && 
                a.classroomId === classroomId && 
                a.examId === examId
            );
            
            if (allocation) {
                // Use existing allocation
                renderExamSeatMap(allocation);
            } else {
                // Create a new allocation
                allocation = {
                    id: `alloc-${Date.now()}`,
                    type: 'exam',
                    classroomId,
                    examId,
                    date,
                    time,
                    layout: null,
                    assignments: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Add to database
                db.allocations.push(allocation);
                
                // Render empty seat map
                renderExamSeatMap(allocation);
            }
            
            document.getElementById('examSeatMapContainer').style.display = 'block';
        }

        // Render exam seat map
        function renderExamSeatMap(allocation) {
            const classroom = db.classrooms.find(c => c.id === allocation.classroomId);
            if (!classroom) return;
            
            const seatMap = document.getElementById('examSeatMap');
            seatMap.innerHTML = '';
            
            // Simple grid layout (could be enhanced with actual classroom layout)
            const cols = Math.ceil(Math.sqrt(classroom.capacity));
            seatMap.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            
            for (let i = 1; i <= classroom.capacity; i++) {
                const seat = document.createElement('div');
                seat.className = 'exam-seat';
                seat.textContent = i;
                seat.dataset.seat = i;
                
                // Check if seat is assigned
                const assignment = allocation.assignments.find(a => a.seat === i.toString());
                if (assignment) {
                    seat.classList.add('occupied');
                    const student = db.students.find(s => s.id === assignment.studentId);
                    if (student) {
                        seat.innerHTML = `${i}<small>${student.name}</small>`;
                    }
                }
                
                // Add drag and drop events
                seat.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    if (!this.classList.contains('occupied')) {
                        this.style.backgroundColor = '#e9ecef';
                    }
                });
                
                seat.addEventListener('dragleave', function() {
                    this.style.backgroundColor = '';
                });
                
                seat.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = '';
                    
                    if (this.classList.contains('occupied')) return;
                    
                    if (draggedStudent) {
                        // Remove any existing assignment for this student
                        allocation.assignments = allocation.assignments.filter(a => a.studentId !== draggedStudent.id);
                        
                        // Add new assignment
                        allocation.assignments.push({
                            studentId: draggedStudent.id,
                            seat: this.dataset.seat
                        });
                        
                        // Update display
                        this.classList.add('occupied');
                        this.innerHTML = `${this.dataset.seat}<small>${draggedStudent.name}</small>`;
                        
                        // Update allocation in database
                        allocation.updatedAt = new Date().toISOString();
                        
                        showToast('Student assigned to seat', 'success');
                    }
                });
                
                seatMap.appendChild(seat);
            }
            
            // Populate available students list
            const availableStudents = db.students.filter(student => 
                !allocation.assignments.some(a => a.studentId === student.id)
            );
            
            const studentsList = document.createElement('div');
            studentsList.className = 'available-students';
            
            availableStudents.forEach(student => {
                const studentCard = document.createElement('div');
                studentCard.className = 'student-card';
                studentCard.textContent = `${student.rollNo} - ${student.name}`;
                studentCard.draggable = true;
                studentCard.dataset.studentId = student.id;
                
                studentCard.addEventListener('dragstart', function() {
                    draggedStudent = student;
                });
                
                studentsList.appendChild(studentCard);
            });
            
            // Add to container or create one if it doesn't exist
            let container = document.getElementById('availableStudentsContainer');
            if (!container) {
                container = document.createElement('div');
                container.id = 'availableStudentsContainer';
                container.style.marginTop = '20px';
                container.innerHTML = '<h4>Available Students</h4>';
                seatMap.parentElement.insertBefore(container, seatMap.nextSibling);
            }
            
            container.innerHTML = '<h4>Available Students</h4>';
            container.appendChild(studentsList);
        }

        // Save exam assignments
        function saveExamAssignments() {
            if (!currentClassroomId || !currentExamId) return;
            
            const allocation = db.allocations.find(a => 
                a.type === 'exam' && 
                a.classroomId === currentClassroomId && 
                a.examId === currentExamId
            );
            
            if (!allocation) return;
            
            allocation.updatedAt = new Date().toISOString();
            showToast('Exam seating saved successfully', 'success');
        }

        // Clear exam assignments
        function clearExamAssignments() {
            if (!currentClassroomId || !currentExamId) return;
            
            const allocation = db.allocations.find(a => 
                a.type === 'exam' && 
                a.classroomId === currentClassroomId && 
                a.examId === currentExamId
            );
            
            if (!allocation) return;
            
            allocation.assignments = [];
            renderExamSeatMap(allocation);
            showToast('All assignments cleared', 'success');
        }

        // Auto assign students
        function autoAssignStudents() {
            if (!currentClassroomId || !currentExamId) return;
            
            const allocation = db.allocations.find(a => 
                a.type === 'exam' && 
                a.classroomId === currentClassroomId && 
                a.examId === currentExamId
            );
            
            if (!allocation) return;
            
            const classroom = db.classrooms.find(c => c.id === currentClassroomId);
            if (!classroom) return;
            
            // Get unassigned students
            const unassignedStudents = db.students.filter(student => 
                !allocation.assignments.some(a => a.studentId === student.id)
            );
            
            if (unassignedStudents.length === 0) {
                showToast('All students are already assigned', 'info');
                return;
            }
            
            // Get available seats
            const seatMap = document.getElementById('examSeatMap');
            const seats = Array.from(seatMap.querySelectorAll('.exam-seat'));
            const availableSeats = seats.filter(seat => !seat.classList.contains('occupied'));
            
            if (availableSeats.length === 0) {
                showToast('No available seats', 'error');
                return;
            }
            
            // Assign students to seats randomly
            const minAssignments = Math.min(unassignedStudents.length, availableSeats.length);
            
            for (let i = 0; i < minAssignments; i++) {
                const student = unassignedStudents[i];
                const seat = availableSeats[i];
                
                allocation.assignments.push({
                    studentId: student.id,
                    seat: seat.dataset.seat
                });
                
                seat.classList.add('occupied');
                seat.innerHTML = `${seat.dataset.seat}<small>${student.name}</small>`;
            }
            
            allocation.updatedAt = new Date().toISOString();
            showToast(`Assigned ${minAssignments} students automatically`, 'success');
        }

        // Print exam seating
        function printExamSeating() {
            if (!currentClassroomId || !currentExamId) return;
            
            const allocation = db.allocations.find(a => 
                a.type === 'exam' && 
                a.classroomId === currentClassroomId && 
                a.examId === currentExamId
            );
            
            if (!allocation) return;
            
            const classroom = db.classrooms.find(c => c.id === currentClassroomId);
            const exam = db.exams.find(e => e.id === currentExamId);
            
            if (!classroom || !exam) return;
            
            // Create print content
            let printHTML = `
                <div class="print-header">
                    <h2>${exam.name} (${exam.code})</h2>
                    <p><strong>Date:</strong> ${allocation.date}</p>
                    <p><strong>Time:</strong> ${allocation.time}</p>
                    <p><strong>Room:</strong> ${classroom.name} (Block ${classroom.block})</p>
                </div>
                <div class="print-seat-map" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px; margin-top: 20px;">
            `;
            
            // Simple grid layout for printing
            for (let i = 1; i <= classroom.capacity; i++) {
                const assignment = allocation.assignments.find(a => a.seat === i.toString());
                let seatClass = 'seat';
                let studentName = '';
                
                if (assignment) {
                    seatClass += ' occupied';
                    const student = db.students.find(s => s.id === assignment.studentId);
                    if (student) {
                        studentName = `<small>${student.name}</small>`;
                    }
                } else {
                    seatClass += ' available';
                }
                
                printHTML += `
                    <div class="${seatClass}" style="width: 60px; height: 60px; border-radius: 5px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 12px; font-weight: bold; border: 1px solid #ccc;">
                        ${i}${studentName}
                    </div>
                `;
            }
            
            printHTML += `</div>`;
            
            // Add legend
            printHTML += `
                <div class="print-legend" style="margin-top: 30px; display: flex; gap: 20px; justify-content: center;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background-color: #4361ee; border-radius: 3px;"></div>
                        <span>Occupied Seat</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background-color: #f8f9fa; border: 1px solid #ccc; border-radius: 3px;"></div>
                        <span>Available Seat</span>
                    </div>
                </div>
            `;
            
            // Set print content and trigger print
            const printContent = document.getElementById('printContent');
            printContent.innerHTML = printHTML;
            
            // Trigger print
            window.print();
        }

        // Load classroom layout
        function loadClassroomLayout() {
            const classroomId = document.getElementById('classroomSelector').value;
            if (!classroomId) {
                document.getElementById('layoutEditorContainer').style.display = 'none';
                document.getElementById('saveLayoutBtn').style.display = 'none';
                return;
            }
            
            currentClassroomId = classroomId;
            const classroom = db.classrooms.find(c => c.id === classroomId);
            if (!classroom) return;
            
            // Check if we have an existing classroom allocation
            let allocation = db.allocations.find(a => 
                a.type === 'classroom' && 
                a.classroomId === classroomId
            );
            
            if (allocation && allocation.layout) {
                // Use existing layout
                currentLayout = allocation.layout;
                renderLayoutGrid(allocation.layout);
            } else {
                // Create a new empty layout
                currentLayout = {
                    rows: 5,
                    cols: 6,
                    seats: Array(5 * 6).fill().map((_, index) => ({
                        row: Math.floor(index / 6),
                        col: index % 6,
                        type: 'empty'
                    }))
                };
                
                renderLayoutGrid(currentLayout);
            }
            
            document.getElementById('layoutEditorContainer').style.display = 'block';
            document.getElementById('saveLayoutBtn').style.display = 'block';
        }

        // Create new layout
        function createNewLayout() {
            if (!currentClassroomId) {
                showToast('Please select a classroom first', 'error');
                return;
            }
            
            const classroom = db.classrooms.find(c => c.id === currentClassroomId);
            if (!classroom) return;
            
            // Prompt for layout dimensions
            const rows = prompt('Enter number of rows:', 5);
            const cols = prompt('Enter number of columns:', 6);
            
            if (!rows || !cols || isNaN(rows) || isNaN(cols)) {
                showToast('Invalid dimensions', 'error');
                return;
            }
            
            // Create empty layout
            currentLayout = {
                rows: parseInt(rows),
                cols: parseInt(cols),
                seats: Array(rows * cols).fill().map((_, index) => ({
                    row: Math.floor(index / cols),
                    col: index % cols,
                    type: 'empty'
                }))
            };
            
            renderLayoutGrid(currentLayout);
            document.getElementById('layoutEditorContainer').style.display = 'block';
            document.getElementById('saveLayoutBtn').style.display = 'block';
        }

        // Render layout grid
        function renderLayoutGrid(layout) {
            const grid = document.getElementById('layoutGrid');
            grid.innerHTML = '';
            
            grid.style.gridTemplateColumns = `repeat(${layout.cols}, 1fr)`;
            grid.style.gridTemplateRows = `repeat(${layout.rows}, 1fr)`;
            
            layout.seats.forEach((seat, index) => {
                const cell = document.createElement('div');
                cell.className = 'layout-cell';
                cell.dataset.row = seat.row;
                cell.dataset.col = seat.col;
                
                // Set cell type
                if (seat.type === 'seat') {
                    cell.classList.add('seat');
                    cell.textContent = index + 1;
                } else if (seat.type === 'wall') {
                    cell.classList.add('wall');
                } else {
                    cell.classList.add('empty');
                }
                
                // Add click event to edit cell
                cell.addEventListener('click', function() {
                    if (currentLayoutTool === 'seat') {
                        this.className = 'layout-cell seat';
                        this.textContent = index + 1;
                        updateLayoutCell(seat.row, seat.col, 'seat');
                    } else if (currentLayoutTool === 'wall') {
                        this.className = 'layout-cell wall';
                        this.textContent = '';
                        updateLayoutCell(seat.row, seat.col, 'wall');
                    } else if (currentLayoutTool === 'empty') {
                        this.className = 'layout-cell empty';
                        this.textContent = '';
                        updateLayoutCell(seat.row, seat.col, 'empty');
                    } else if (currentLayoutTool === 'delete') {
                        this.className = 'layout-cell empty';
                        this.textContent = '';
                        updateLayoutCell(seat.row, seat.col, 'empty');
                    }
                });
                
                grid.appendChild(cell);
            });
        }

        // Update layout cell
        function updateLayoutCell(row, col, type) {
            const seatIndex = currentLayout.seats.findIndex(s => s.row == row && s.col == col);
            if (seatIndex >= 0) {
                currentLayout.seats[seatIndex].type = type;
            }
        }

        // Save classroom layout
        function saveClassroomLayout() {
            if (!currentClassroomId || !currentLayout) return;
            
            // Find or create classroom allocation
            let allocation = db.allocations.find(a => 
                a.type === 'classroom' && 
                a.classroomId === currentClassroomId
            );
            
            if (!allocation) {
                allocation = {
                    id: `alloc-${Date.now()}`,
                    type: 'classroom',
                    classroomId: currentClassroomId,
                    examId: null,
                    date: null,
                    time: null,
                    layout: currentLayout,
                    assignments: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                db.allocations.push(allocation);
            } else {
                allocation.layout = currentLayout;
                allocation.updatedAt = new Date().toISOString();
            }
            
            showToast('Classroom layout saved successfully', 'success');
        }

        // Show assign students modal
        function showAssignStudentsModal() {
            if (!currentClassroomId) {
                showToast('Please select a classroom first', 'error');
                return;
            }
            
            const allocation = db.allocations.find(a => 
                a.type === 'classroom' && 
                a.classroomId === currentClassroomId
            );
            
            if (!allocation || !allocation.layout) {
                showToast('Please save the layout first', 'error');
                return;
            }
            
            // Populate available students
            const availableStudents = db.students.filter(student => 
                !allocation.assignments.some(a => a.studentId === student.id)
            );
            
            const studentsList = document.getElementById('availableStudentsList');
            studentsList.innerHTML = '';
            
            availableStudents.forEach(student => {
                const studentCard = document.createElement('div');
                studentCard.className = 'student-card';
                studentCard.textContent = `${student.rollNo} - ${student.name}`;
                studentCard.draggable = true;
                studentCard.dataset.studentId = student.id;
                
                studentCard.addEventListener('dragstart', function() {
                    draggedStudent = student;
                });
                
                studentsList.appendChild(studentCard);
            });
            
            // Render classroom seat map
            const seatMap = document.getElementById('classroomSeatMap');
            seatMap.innerHTML = '';
            seatMap.style.gridTemplateColumns = `repeat(${allocation.layout.cols}, 1fr)`;
            seatMap.style.gridTemplateRows = `repeat(${allocation.layout.rows}, 1fr)`;
            
            allocation.layout.seats.forEach((seat, index) => {
                const seatElement = document.createElement('div');
                seatElement.className = 'seat';
                
                if (seat.type === 'seat') {
                    const seatNumber = index + 1;
                    seatElement.textContent = seatNumber;
                    seatElement.dataset.seat = seatNumber;
                    
                    // Check if seat is assigned
                    const assignment = allocation.assignments.find(a => a.seat === seatNumber.toString());
                    if (assignment) {
                        seatElement.classList.add('occupied');
                        const student = db.students.find(s => s.id === assignment.studentId);
                        if (student) {
                            seatElement.innerHTML = `${seatNumber}<small>${student.name}</small>`;
                        }
                    }
                    
                    // Add drag and drop events
                    seatElement.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        if (!this.classList.contains('occupied')) {
                            this.style.backgroundColor = '#e9ecef';
                        }
                    });
                    
                    seatElement.addEventListener('dragleave', function() {
                        this.style.backgroundColor = '';
                    });
                    
                    seatElement.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.style.backgroundColor = '';
                        
                        if (this.classList.contains('occupied')) return;
                        
                        if (draggedStudent) {
                            // Remove any existing assignment for this student
                            allocation.assignments = allocation.assignments.filter(a => a.studentId !== draggedStudent.id);
                            
                            // Add new assignment
                            allocation.assignments.push({
                                studentId: draggedStudent.id,
                                seat: this.dataset.seat
                            });
                            
                            // Update display
                            this.classList.add('occupied');
                            this.innerHTML = `${this.dataset.seat}<small>${draggedStudent.name}</small>`;
                            
                            // Remove student from available list
                            const studentCard = document.querySelector(`.student-card[data-student-id="${draggedStudent.id}"]`);
                            if (studentCard) {
                                studentCard.remove();
                            }
                            
                            showToast('Student assigned to seat', 'success');
                        }
                    });
                } else if (seat.type === 'wall') {
                    seatElement.className = 'seat wall';
                } else {
                    seatElement.className = 'seat empty';
                }
                
                seatMap.appendChild(seatElement);
            });
            
            // Show modal
            document.getElementById('assignStudentsModal').style.display = 'flex';
        }

        // Save classroom assignments
        function saveClassroomAssignments() {
            if (!currentClassroomId) return;
            
            const allocation = db.allocations.find(a => 
                a.type === 'classroom' && 
                a.classroomId === currentClassroomId
            );
            
            if (!allocation) return;
            
            allocation.updatedAt = new Date().toISOString();
            showToast('Classroom assignments saved successfully', 'success');
            document.getElementById('assignStudentsModal').style.display = 'none';
        }

        // Print classroom layout
        function printClassroomLayout() {
            if (!currentClassroomId) return;
            
            const allocation = db.allocations.find(a => 
                a.type === 'classroom' && 
                a.classroomId === currentClassroomId
            );
            
            if (!allocation || !allocation.layout) return;
            
            const classroom = db.classrooms.find(c => c.id === currentClassroomId);
            if (!classroom) return;
            
            // Create print content
            let printHTML = `
                <div class="print-header">
                    <h2>${classroom.name} (Block ${classroom.block})</h2>
                    <p>Classroom Seating Layout</p>
                </div>
                <div class="print-seat-map" style="display: grid; grid-template-columns: repeat(${allocation.layout.cols}, 1fr); grid-template-rows: repeat(${allocation.layout.rows}, 1fr); gap: 10px; margin-top: 20px;">
            `;
            
            allocation.layout.seats.forEach((seat, index) => {
                const seatNumber = index + 1;
                let seatClass = 'seat';
                let content = '';
                
                if (seat.type === 'seat') {
                    const assignment = allocation.assignments.find(a => a.seat === seatNumber.toString());
                    if (assignment) {
                        seatClass += ' occupied';
                        const student = db.students.find(s => s.id === assignment.studentId);
                        if (student) {
                            content = `${seatNumber}<small>${student.name}</small>`;
                        } else {
                            content = seatNumber;
                        }
                    } else {
                        seatClass += ' available';
                        content = seatNumber;
                    }
                } else if (seat.type === 'wall') {
                    seatClass += ' wall';
                } else {
                    seatClass += ' empty';
                }
                
                printHTML += `
                    <div class="${seatClass}" style="width: 60px; height: 60px; border-radius: 5px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 12px; font-weight: bold; border: 1px solid #ccc;">
                        ${content}
                    </div>
                `;
            });
            
            printHTML += `</div>`;
            
            // Add legend
            printHTML += `
                <div class="print-legend" style="margin-top: 30px; display: flex; gap: 20px; justify-content: center;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background-color: #4361ee; border-radius: 3px;"></div>
                        <span>Occupied Seat</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background-color: #f8f9fa; border: 1px solid #ccc; border-radius: 3px;"></div>
                        <span>Available Seat</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background-color: #212529; border-radius: 3px;"></div>
                        <span>Wall</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background-color: transparent; border: 1px dashed #6c757d; border-radius: 3px;"></div>
                        <span>Empty Space</span>
                    </div>
                </div>
            `;
            
            // Set print content and trigger print
            const printContent = document.getElementById('printContent');
            printContent.innerHTML = printHTML;
            
            // Trigger print
            window.print();
        }

        // Load allocation management data
        function loadAllocationManagementData() {
            // Populate filter dropdowns
            const classroomSelect = document.getElementById('filterClassroom');
            classroomSelect.innerHTML = '<option value="">All Classrooms</option>';
            db.classrooms.forEach(classroom => {
                const option = document.createElement('option');
                option.value = classroom.id;
                option.textContent = `${classroom.name} (Block ${classroom.block})`;
                classroomSelect.appendChild(option);
            });
            
            // Load allocations table
            loadAllocationsTable();
        }

        // Load allocations table
        function loadAllocationsTable(filterType = '', filterClassroom = '', filterDate = '') {
            const tableBody = document.getElementById('allocationsTableBody');
            tableBody.innerHTML = '';
            
            let filteredAllocations = [...db.allocations];
            
            // Apply filters
            if (filterType) {
                filteredAllocations = filteredAllocations.filter(a => a.type === filterType);
            }
            
            if (filterClassroom) {
                filteredAllocations = filteredAllocations.filter(a => a.classroomId === filterClassroom);
            }
            
            if (filterDate) {
                filteredAllocations = filteredAllocations.filter(a => a.date === filterDate);
            }
            
            // Sort by date (newest first)
            filteredAllocations.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filteredAllocations.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <p>No allocations found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredAllocations.forEach(allocation => {
                const classroom = db.classrooms.find(c => c.id === allocation.classroomId);
                const exam = allocation.examId ? db.exams.find(e => e.id === allocation.examId) : null;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${allocation.type === 'exam' ? 'Exam' : 'Classroom'}</td>
                    <td>${classroom ? `${classroom.name} (Block ${classroom.block})` : 'Unknown'}</td>
                    <td>${allocation.type === 'exam' ? 
                        (exam ? `${exam.name} (${exam.code})` : 'Unknown') : 
                        'Classroom Allocation'}</td>
                    <td>${allocation.date ? new Date(allocation.date).toLocaleDateString() : '-'}</td>
                    <td>${allocation.time || '-'}</td>
                    <td>${allocation.assignments.length}</td>
                    <td>
                        <button class="action-btn edit" data-id="${allocation.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" data-id="${allocation.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.action-btn.edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const allocationId = this.dataset.id;
                    editAllocation(allocationId);
                });
            });
            
            document.querySelectorAll('.action-btn.delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const allocationId = this.dataset.id;
                    deleteAllocation(allocationId);
                });
            });
        }

        // Apply allocation filters
        function applyAllocationFilters() {
            const filterType = document.getElementById('filterType').value;
            const filterClassroom = document.getElementById('filterClassroom').value;
            const filterDate = document.getElementById('filterDate').value;
            
            loadAllocationsTable(filterType, filterClassroom, filterDate);
        }

        // Clear allocation filters
        function clearAllocationFilters() {
            document.getElementById('filterType').value = '';
            document.getElementById('filterClassroom').value = '';
            document.getElementById('filterDate').value = '';
            
            loadAllocationsTable();
        }

        // Edit allocation
        function editAllocation(allocationId) {
            const allocation = db.allocations.find(a => a.id === allocationId);
            if (!allocation) return;
            
            if (allocation.type === 'exam') {
                // For exam allocations, go to seat allocation with the exam pre-selected
                showAdminSection('seat-allocation');
                document.getElementById('examClassroom').value = allocation.classroomId;
                document.getElementById('examSubject').value = allocation.examId;
                document.getElementById('examDate').value = allocation.date;
                document.getElementById('examTime').value = allocation.time;
                
                // Trigger generate seating
                document.getElementById('generateExamSeatingBtn').click();
            } else {
                // For classroom allocations, go to classroom allocation with the classroom pre-selected
                showAdminSection('seat-allocation');
                document.querySelector('.mode-toggle-btn[data-mode="classroom"]').click();
                document.getElementById('classroomSelector').value = allocation.classroomId;
                
                // Trigger load layout
                document.getElementById('classroomSelector').dispatchEvent(new Event('change'));
            }
        }

        // Delete allocation
        function deleteAllocation(allocationId) {
            if (confirm('Are you sure you want to delete this allocation?')) {
                db.allocations = db.allocations.filter(a => a.id !== allocationId);
                loadAllocationsTable();
                showToast('Allocation deleted successfully', 'success');
            }
        }

        // Export allocations
        function exportAllocations() {
            const data = {
                allocations: db.allocations,
                exportedAt: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportName = `exam-seat-allocations-${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportName);
            linkElement.click();
            
            showToast('Allocations exported successfully', 'success');
        }

        // Handle import
        function handleImport() {
            const importType = document.getElementById('importType').value;
            const fileInput = document.getElementById('importFile');
            
            if (!fileInput.files.length) {
                showToast('Please select a file to import', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (importType === 'students') {
                        if (data.students && Array.isArray(data.students)) {
                            // Merge with existing students (skip duplicates)
                            data.students.forEach(newStudent => {
                                if (!db.students.some(s => s.rollNo === newStudent.rollNo)) {
                                    db.students.push(newStudent);
                                }
                            });
                            
                            showToast(`${data.students.length} students imported`, 'success');
                            loadStudentsTable();
                        } else {
                            showToast('Invalid student data format', 'error');
                        }
                    } else if (importType === 'allocations') {
                        if (data.allocations && Array.isArray(data.allocations)) {
                            // Replace existing allocations
                            db.allocations = data.allocations;
                            
                            showToast(`${data.allocations.length} allocations imported`, 'success');
                            loadAllocationsTable();
                        } else {
                            showToast('Invalid allocation data format', 'error');
                        }
                    }
                    
                    document.getElementById('importModal').style.display = 'none';
                } catch (error) {
                    showToast('Error parsing JSON file', 'error');
                    console.error(error);
                }
            };
            
            reader.readAsText(file);
        }

        // Load students table
        function loadStudentsTable() {
            const tableBody = document.getElementById('studentsTableBody');
            tableBody.innerHTML = '';
            
            if (db.students.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-users"></i>
                            <p>No students found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            db.students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.rollNo}</td>
                    <td>${student.name}</td>
                    <td>${student.email || '-'}</td>
                    <td>${student.department || '-'}</td>
                    <td>
                        <button class="action-btn edit" data-id="${student.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" data-id="${student.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.action-btn.edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = this.dataset.id;
                    editStudent(studentId);
                });
            });
            
            document.querySelectorAll('.action-btn.delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = this.dataset.id;
                    deleteStudent(studentId);
                });
            });
        }

        // Show add student form
        function showAddStudentForm() {
            document.getElementById('studentModalTitle').textContent = 'Add New Student';
            document.getElementById('studentId').value = '';
            document.getElementById('studentForm').reset();
            document.getElementById('studentModal').style.display = 'flex';
        }

        // Edit student
        function editStudent(studentId) {
            const student = db.students.find(s => s.id === studentId);
            if (!student) return;
            
            document.getElementById('studentModalTitle').textContent = 'Edit Student';
            document.getElementById('studentId').value = student.id;
            document.getElementById('studentRollNo').value = student.rollNo;
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentEmail').value = student.email || '';
            document.getElementById('studentDepartment').value = student.department || '';
            document.getElementById('studentPassword').value = student.password;
            
            document.getElementById('studentModal').style.display = 'flex';
        }

        // Save student
        function saveStudent(e) {
            e.preventDefault();
            
            const studentId = document.getElementById('studentId').value;
            const rollNo = document.getElementById('studentRollNo').value;
            const name = document.getElementById('studentName').value;
            const email = document.getElementById('studentEmail').value;
            const department = document.getElementById('studentDepartment').value;
            const password = document.getElementById('studentPassword').value;
            
            if (!rollNo || !name || !password) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            if (studentId) {
                // Update existing student
                const student = db.students.find(s => s.id === studentId);
                if (student) {
                    student.rollNo = rollNo;
                    student.name = name;
                    student.email = email;
                    student.department = department;
                    student.password = password;
                    
                    showToast('Student updated successfully', 'success');
                }
            } else {
                // Add new student
                const newStudent = {
                    id: `s${Date.now()}`,
                    rollNo,
                    name,
                    email,
                    department,
                    password
                };
                
                db.students.push(newStudent);
                showToast('Student added successfully', 'success');
            }
            
            document.getElementById('studentModal').style.display = 'none';
            loadStudentsTable();
        }

        // Delete student
        function deleteStudent(studentId) {
            if (confirm('Are you sure you want to delete this student?')) {
                db.students = db.students.filter(s => s.id !== studentId);
                
                // Also remove any allocations for this student
                db.allocations.forEach(allocation => {
                    allocation.assignments = allocation.assignments.filter(a => a.studentId !== studentId);
                });
                
                loadStudentsTable();
                showToast('Student deleted successfully', 'success');
            }
        }

        // Load classrooms table
        function loadClassroomsTable() {
            const tableBody = document.getElementById('classroomsTableBody');
            tableBody.innerHTML = '';
            
            if (db.classrooms.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-building"></i>
                            <p>No classrooms found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            db.classrooms.forEach(classroom => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${classroom.id}</td>
                    <td>${classroom.name}</td>
                    <td>${classroom.block}</td>
                    <td>${classroom.capacity}</td>
                    <td>${classroom.layouts ? classroom.layouts.length : 0}</td>
                    <td>
                        <button class="action-btn edit" data-id="${classroom.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" data-id="${classroom.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.action-btn.edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const classroomId = this.dataset.id;
                    editClassroom(classroomId);
                });
            });
            
            document.querySelectorAll('.action-btn.delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const classroomId = this.dataset.id;
                    deleteClassroom(classroomId);
                });
            });
        }

        // Show add classroom form
        function showAddClassroomForm() {
            document.getElementById('classroomModalTitle').textContent = 'Add New Classroom';
            document.getElementById('classroomId').value = '';
            document.getElementById('classroomForm').reset();
            document.getElementById('classroomModal').style.display = 'flex';
        }

        // Edit classroom
        function editClassroom(classroomId) {
            const classroom = db.classrooms.find(c => c.id === classroomId);
            if (!classroom) return;
            
            document.getElementById('classroomModalTitle').textContent = 'Edit Classroom';
            document.getElementById('classroomId').value = classroom.id;
            document.getElementById('classroomName').value = classroom.name;
            document.getElementById('classroomBlock').value = classroom.block;
            document.getElementById('classroomCapacity').value = classroom.capacity;
            
            document.getElementById('classroomModal').style.display = 'flex';
        }

        // Save classroom
        function saveClassroom(e) {
            e.preventDefault();
            
            const classroomId = document.getElementById('classroomId').value;
            const name = document.getElementById('classroomName').value;
            const block = document.getElementById('classroomBlock').value;
            const capacity = document.getElementById('classroomCapacity').value;
            
            if (!name || !block || !capacity) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            if (classroomId) {
                // Update existing classroom
                const classroom = db.classrooms.find(c => c.id === classroomId);
                if (classroom) {
                    classroom.name = name;
                    classroom.block = block;
                    classroom.capacity = parseInt(capacity);
                    
                    showToast('Classroom updated successfully', 'success');
                }
            } else {
                // Add new classroom
                const newClassroom = {
                    id: `c${Date.now()}`,
                    name,
                    block,
                    capacity: parseInt(capacity),
                    layouts: []
                };
                
                db.classrooms.push(newClassroom);
                showToast('Classroom added successfully', 'success');
            }
            
            document.getElementById('classroomModal').style.display = 'none';
            loadClassroomsTable();
            loadSeatAllocationData(); // Refresh dropdowns
        }

        // Delete classroom
        function deleteClassroom(classroomId) {
            if (confirm('Are you sure you want to delete this classroom?')) {
                db.classrooms = db.classrooms.filter(c => c.id !== classroomId);
                
                // Also remove any allocations for this classroom
                db.allocations = db.allocations.filter(a => a.classroomId !== classroomId);
                
                loadClassroomsTable();
                loadSeatAllocationData(); // Refresh dropdowns
                showToast('Classroom deleted successfully', 'success');
            }
        }

        // Load exams table
        function loadExamsTable() {
            const tableBody = document.getElementById('examsTableBody');
            tableBody.innerHTML = '';
            
            if (db.exams.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-book"></i>
                            <p>No exams found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            db.exams.forEach(exam => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${exam.id}</td>
                    <td>${exam.name}</td>
                    <td>${exam.code}</td>
                    <td>${new Date(exam.date).toLocaleDateString()}</td>
                    <td>${exam.time}</td>
                    <td>
                        <button class="action-btn edit" data-id="${exam.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" data-id="${exam.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.action-btn.edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examId = this.dataset.id;
                    editExam(examId);
                });
            });
            
            document.querySelectorAll('.action-btn.delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examId = this.dataset.id;
                    deleteExam(examId);
                });
            });
        }

        // Show add exam form
        function showAddExamForm() {
            document.getElementById('examModalTitle').textContent = 'Add New Exam';
            document.getElementById('examId').value = '';
            document.getElementById('examForm').reset();
            document.getElementById('examModal').style.display = 'flex';
        }

        // Edit exam
        function editExam(examId) {
            const exam = db.exams.find(e => e.id === examId);
            if (!exam) return;
            
            document.getElementById('examModalTitle').textContent = 'Edit Exam';
            document.getElementById('examId').value = exam.id;
            document.getElementById('examName').value = exam.name;
            document.getElementById('examCode').value = exam.code;
            document.getElementById('examDate').value = exam.date;
            document.getElementById('examTime').value = exam.time;
            
            document.getElementById('examModal').style.display = 'flex';
        }

        // Save exam
        function saveExam(e) {
            e.preventDefault();
            
            const examId = document.getElementById('examId').value;
            const name = document.getElementById('examName').value;
            const code = document.getElementById('examCode').value;
            const date = document.getElementById('examDate').value;
            const time = document.getElementById('examTime').value;
            
            if (!name || !code || !date || !time) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            if (examId) {
                // Update existing exam
                const exam = db.exams.find(e => e.id === examId);
                if (exam) {
                    exam.name = name;
                    exam.code = code;
                    exam.date = date;
                    exam.time = time;
                    
                    showToast('Exam updated successfully', 'success');
                }
            } else {
                // Add new exam
                const newExam = {
                    id: `e${Date.now()}`,
                    name,
                    code,
                    date,
                    time
                };
                
                db.exams.push(newExam);
                showToast('Exam added successfully', 'success');
            }
            
            document.getElementById('examModal').style.display = 'none';
            loadExamsTable();
            loadSeatAllocationData(); // Refresh dropdowns
        }

        // Delete exam
        function deleteExam(examId) {
            if (confirm('Are you sure you want to delete this exam?')) {
                db.exams = db.exams.filter(e => e.id !== examId);
                
                // Also remove any allocations for this exam
                db.allocations = db.allocations.filter(a => a.examId !== examId);
                
                loadExamsTable();
                loadSeatAllocationData(); // Refresh dropdowns
                showToast('Exam deleted successfully', 'success');
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toastNotification');
            toast.className = `toast ${type}`;
            document.getElementById('toastMessage').textContent = message;
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>